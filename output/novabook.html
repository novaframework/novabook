<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Build web application with Nova</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #c4a000; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #000000; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #000000; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #000000; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
  
</head>
<body>
<header id="title-block-header">
<h1 class="title">Build web application with Nova</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#nova">Nova</a>
<ul>
<li><a href="#how-to-read-this">How to read this</a>
<ul>
<li><a href="#part-1">Part 1</a></li>
<li><a href="#part-2">Part 2</a></li>
<li><a href="#part-3">Part 3</a></li>
</ul></li>
<li><a href="#pre-req">Pre req</a></li>
<li><a href="#installing-nova">Installing Nova</a></li>
<li><a href="#background">Background</a>
<ul>
<li><a href="#erlang-web-frameworks">Erlang web frameworks</a></li>
<li><a href="#the-beginning">The beginning</a></li>
</ul></li>
<li><a href="#architecture-design">Architecture &amp; Design</a>
<ul>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#design">Design</a></li>
</ul></li>
</ul></li>
<li><a href="#part-1---view-controller">Part 1 - View-Controller</a>
<ul>
<li><a href="#getting-started">Getting Started</a>
<ul>
<li><a href="#what-did-we-get">What did we get?</a></li>
</ul></li>
<li><a href="#controllers-views">Controllers &amp; Views</a>
<ul>
<li><a href="#controllers">Controllers</a></li>
</ul></li>
<li><a href="#what-do-we-have-in-this-module">What do we have in this module?</a>
<ul>
<li><a href="#views">Views</a></li>
</ul></li>
<li><a href="#adding-auth-and-different-views">Adding auth and different views</a></li>
<li><a href="#we-need-to-create-the-controller-now-and-the-view-for-this-my_first_nova_login_controller.erl-in-srccontrollers.">We need to create the controller now and the view for this, <code>my_first_nova_login_controller.erl</code> in <code>src/controllers/</code>.</a></li>
<li><a href="#routing">Routing</a>
<ul>
<li><a href="#static-content">Static content</a></li>
</ul></li>
</ul></li>
<li><a href="#part-2---api-server">Part 2 - API server</a>
<ul>
<li><a href="#testing">Testing</a>
<ul>
<li><a href="#test-suite">Test Suite</a></li>
<li><a href="#pipeline">Pipeline</a></li>
<li><a href="#prioritization-configuration">Prioritization &amp; Configuration</a></li>
<li><a href="#writing-plugins">Writing plugins</a></li>
</ul></li>
</ul></li>
<li><a href="#part-3---using-js-framework">Part 3 - Using JS framework</a>
<ul>
<li><a href="#routing-1">Routing</a>
<ul>
<li><a href="#static-content-1">Static content</a></li>
</ul></li>
</ul></li>
<li><a href="#erlang">Erlang</a>
<ul>
<li><a href="#erlang-books">Erlang books</a></li>
<li><a href="#recursive-functions">Recursive functions</a></li>
<li><a href="#pattern-matching">Pattern matching</a>
<ul>
<li><a href="#maps-records-tuples">maps, records, tuples</a></li>
</ul></li>
<li><a href="#releases">Releases</a></li>
<li><a href="#supervisors">Supervisors</a></li>
</ul></li>
<li><a href="#beam-languages">Beam languages</a>
<ul>
<li><a href="#lfe">LFE</a></li>
</ul></li>
</ul>
</nav>
<h1 id="nova">Nova</h1>
<h2 id="how-to-read-this">How to read this</h2>
<h3 id="part-1">Part 1</h3>
<p>Here we will discuss foundation of Nova, how to use it as a view-controller. This section will be larger abd be the foundation of the rest of the book. I will describe not only Nova but also Erlang.</p>
<h3 id="part-2">Part 2</h3>
<p>In this section we will show how to use Nova as a api server withour views. With routing and plugins.</p>
<h3 id="part-3">Part 3</h3>
<p>In this section we will show how to use js frameworks and static pages with Nova.</p>
<h2 id="pre-req">Pre req</h2>
<p>You will need erlang 22+ installed and rebar3.</p>
<h2 id="installing-nova">Installing Nova</h2>
<p>Add rebar3_nova to ~/.config/rebar3/rebar.config</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="ch">project_plugins</span><span class="fu">,</span> <span class="fu">[</span><span class="ch">rebar3_nova</span><span class="fu">]}</span></span></code></pre></div>
<hr />
<h2 id="background">Background</h2>
<h3 id="erlang-web-frameworks">Erlang web frameworks</h3>
<p>Both me and Niclas have used many different web frameworks in Erlang. We started to code Erlang around 2009 and at that time we had frameworks like Nitrogen, Erlang Web and Zotonic. Some years later Chicago Boss was introduced that tried to solve many things. But one of the things with Chicago Boss was that it didn’t really follow OTP standard when it came to release handling.</p>
<p>In 2011 Loïc Hoguin released Cowboy, an Erlang web server. It was very fast and stable web server that got popular in the Erlang community.</p>
<p>Many Erlang companies started to use Cowboy and everytime me or Niclas came in contact with it we needed to start writing all the handlers, or work with a wrapper around.</p>
<p>I started my Erlang coding with a project course at Uppsala University where we did a e-commerce system written with Nitrogen and Riak. This was late 2009, riak was a new and untested database also was Nitrogen something new.</p>
<p>From this both me and Niclas have helped companies to launch web applications with Erlang or as employees develop these kind of systems.</p>
<h3 id="the-beginning">The beginning</h3>
<p>In a hotel room in Gratz we started to look at some of our projects we have started during all the years. Niclas had earlier started a framework called Burbweb, this would later be the start of Nova. Some years before that we had worked on a ORM library in Erlang. We got an idea that we should try to make a product of this and really try to aim for a new good framework that people can use.</p>
<p>We started to look into how we can help users to get started easy and also try to make easy release builds.</p>
<p>So in 2019 we released Nova that we now have worked on and try to make it better.</p>
<p>Zaark was a company that both me and Niclas worked at and later started to use Nova in production. Mostly as a api server without views. From the feedback using Nova we improved it and felt we are doing something great.</p>
<p>2020 we had our first presentation about Nova at code beam.</p>
<hr />
<h2 id="architecture-design">Architecture &amp; Design</h2>
<h3 id="architecture">Architecture</h3>
<p>Nova is built on top of Cowboy that is a web server written in Erlang. One of the reason was that it is a well tested web server, that have great features.</p>
<p>In the beginning we used Cowboy routing but later we did see that we wanted to handle appliction modilarity. That is for us that you can include other Nova applications into your application.</p>
<h3 id="design">Design</h3>
<p>One of the things that we wanted with Nova is that it should make it easier to start a new web application projet in Erlang. Without spending much time on boilerplate Cowboy for your project, or write your own wrapper around it.</p>
<p>The other thing is that what is core features in Nova should be small and we should not use that many dependencies. When we discuss new things we usually ask if this is something that extends the core Nova or if it is something that builds on top of Nova.</p>
<p>This is also one of thea reason for plugin system, that helps us to leave to other to write how they want to handle requests. Instead of building everything in Nova.</p>
<p>One of the design philosopies we have is that is should be using as much as we can standard OTP utilites and release tools. In this case we use rebar3 that uses relx, we see that more and more it is getting to be the standard. (While writing this OTP will make rebar3 as a part of OTP.)</p>
<hr />
<h1 id="part-1---view-controller">Part 1 - View-Controller</h1>
<p>In this section I will show how you can use Nova as a view-controller framework. We will use Nova views that uses erlydtl (Djangot templating).</p>
<p>In the end of this section we will have a web application where you can signup, login and list users and edit a user.</p>
<h2 id="getting-started">Getting Started</h2>
<p>First we will generate a new Nova app that we will work with.</p>
<p>You will see that the template setup the directory and configurations to get first app running.</p>
<p>This will start user_management application with a shell. Now open a browser and go to <code>http://localhost:8080</code> you should see a page with the text <code>Nova is running!</code></p>
<p><strong><em>Erlang</em></strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> new nova user_management</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/config/dev_sys.config</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/config/prod_sys.config</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/priv/user_management.routes.erl</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/user_management.app.src</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/user_management_app.erl</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/user_management_sup.erl</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/controllers/user_management_main_controller.erl</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/rebar.config</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/config/vm.args</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/views/user_management_main.dtl</span></code></pre></div>
<p>When this is installed you can run:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> shell</span></code></pre></div>
<hr />
<p><strong><em>LFE</em></strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> new nova_lfe user_management</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/config/sys.config</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/priv/user_management.routes.lfe</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/user_management.app.src</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/app.lfe</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/sup.lfe</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/controllers/user_management_main_controller.lfe</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/rebar.config</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/config/vm.args</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="ex">===</span><span class="op">&gt;</span> Writing user_management/src/views/user_management_main.dtl</span></code></pre></div>
<p>When this is installed you can run:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> compile</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> lfe repl</span></code></pre></div>
<hr />
<h3 id="what-did-we-get">What did we get?</h3>
<p>Nova app have some configuration files, route file, controllers and views.</p>
<p>First the sys.config, this handle the user_management application.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">%% -*- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil -*-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">[</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">{</span><span class="ch">kernel</span><span class="fu">,</span> <span class="fu">[</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">{</span><span class="ch">logger_level</span><span class="fu">,</span> <span class="ch">debug</span><span class="fu">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">]},</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">{</span><span class="ch">nova</span><span class="fu">,</span> <span class="fu">[</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">cowboy_configuration</span><span class="fu">,</span> <span class="fu">#{</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="ch">port</span> <span class="op">=&gt;</span> <span class="dv">8080</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">}},</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">dev_mode</span><span class="fu">,</span> <span class="ch">true</span><span class="fu">},</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">bootstrap_application</span><span class="fu">,</span> <span class="ch">my_first_nova</span><span class="fu">},</span> <span class="co">%% Bootstraps the application</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">plugins</span><span class="fu">,</span> <span class="fu">[</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">]}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">]}</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">%% Please change your app.src-file instead if you intend to add app-specific configurations</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">].</span></span></code></pre></div>
<p>What do we have here? Well kernel section is for logging with logger, here we can later add different formatters or log handlers, this is basic Erlang configurations.</p>
<p>Nova section handles the nova application and when we start Nova in our app my_first_nova it knows what port and plugins it should use. Also what is the main app, the bootstrap_application section.</p>
<p>Plugins is a new feature that we are working with, but it is a way to have modules do som pre/post handling on your request.</p>
<p>Example: &gt; You want to get a user,for each request you want to have a correlation id. This can then be generated in a pre plugin that adds it to the header and pass it on. Then it can be used in the controller to keep track of what goes on.</p>
<p>Then we have the route file my_first_nova.routes.erl in this you will specify all endpoints or static assets that you want to expose.</p>
<hr />
<p><strong><em>Erlang</em></strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">{</span><span class="st">&quot;/&quot;</span><span class="fu">,{</span> <span class="ch">my_first_nova_main_controller</span><span class="fu">,</span> <span class="ch">index</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}}</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">],</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="ch">statics</span> <span class="op">=&gt;</span> <span class="fu">[</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/assets/[...]&quot;</span><span class="fu">,</span> <span class="st">&quot;assets&quot;</span><span class="fu">}</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">]</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}.</span></span></code></pre></div>
<hr />
<p><strong><em>LFE</em></strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>#m(prefix <span class="st">&quot;&quot;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>   security false</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>   routes (#(<span class="st">&quot;/&quot;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>             #(user_management_main_controller index)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>             #M(methods (<span class="kw">get</span>)))))</span></code></pre></div>
<hr />
<p>Prefix is if you want to have something before the routes. Say “v1” then you can add it to prefix.</p>
<p>Security is if you want any way to auth the request. Change security to {Module, Function} instead of false if you want to have a auth module.</p>
<p>Routes is a tuple {PATH, { MODULE, FUNCTION }, OPTIONS}. If we break down the file above it will go to <code>http://localhost:8080/</code> and it will only allow method GET. When someone is doing a GET agains this it will use module my_first_nova_main_controller with function index.</p>
<p>This is the configurations that is for Nova.</p>
<hr />
<h2 id="controllers-views">Controllers &amp; Views</h2>
<p>Controllers and Views are the VC part of the framework. Nova haven’t got the model part yet for data but it have been discussed.</p>
<p>In src we have a views directory that will contain all your views that will also have a controller with the same name in the directory controllers.</p>
<p>When we configure routing we will poing the module and function to the controller that will do some logic and then return {ok, Proplist}. When controller return ok tuple Nova will understand that it should render the view file and return it.</p>
<h3 id="controllers">Controllers</h3>
<p>This is a basic controller that will return back a proplist back to the view. In this case it will return with a message that the view will populate.</p>
<h2 id="what-do-we-have-in-this-module">What do we have in this module?</h2>
<p><strong><em>Erlang</em></strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">%% This is the module declaration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">user_management_main_controller</span><span class="fu">).</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">%% What functions that are exported from this module.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="ch">index</span><span class="op">/</span><span class="dv">1</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">]).</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">%% Function header.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">index(</span><span class="va">_</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">%% Returns a tuple with ok and a proplists (Key-Value list)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="fu">[{</span><span class="ch">message</span><span class="fu">,</span> <span class="st">&quot;Nova is running!&quot;</span><span class="fu">}]}.</span></span></code></pre></div>
<hr />
<p><strong><em>LFE</em></strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(defmodule user_management_main_controller</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">export</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>   (index <span class="dv">1</span>)))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>(include-lib <span class="st">&quot;logjam/include/logjam.hrl&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> index</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">;;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">;; GET Handler</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">;;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  ((`#m(req #m(<span class="kw">method</span> #<span class="st">&quot;GET&quot;</span>)))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    `#(ok (#(message <span class="st">&quot;nova is running!&quot;</span>)))))</span></code></pre></div>
<hr />
<p>An Erlang module is structured first to have the module declaration to say that it is a module this is done with the first line <code>-module(Module)</code>. Comments are done with <code>%</code>, good rule is to use %% when comment on a line and % if you comment after code.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">%% This is a comment</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">my_function()</span> <span class="op">-&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="ch">ok</span><span class="fu">.</span> <span class="co">% Comment after code</span></span></code></pre></div>
<p>After this we have the export that will export functions outside the module so other can modules can use it or you can use it from a shell.</p>
<p>Then we have the index functions that in this take one argument.</p>
<p>If you change the message it will also be changed on the site.</p>
<h3 id="views">Views</h3>
<p>Each view have a controller for logic, the view is a Django template file.</p>
<p>Our view my_first_nova_main_view.dtl:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;h1&gt;</span>{{message}}<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>From the controller we will get <code>Nova is running!</code>. That we will template into <code>{{message}}</code> that will show it on the homepage. What will happen here is that <code>{{ message }}</code> will be changed to the text that we get from our index function in section about the controller above. If we change the text it will also be added to the page.</p>
<h2 id="adding-auth-and-different-views">Adding auth and different views</h2>
<p>In previous section we created a Nova application.</p>
<p>Now we will add a small login form and try to auth and if we pass it will show a view with message “Welcome Daniel!”.</p>
<p>The structure we have in applications using nova is that in src/ we usually have modules that is used by our application. In the directory src/controllers we will have erlang modules that will be used to handle requests. In the directory src/views we have the .dtl files for our endpoints. The names need to match so MY_VIEW.dtl should match MY_VIEW_controller.erl.</p>
<p>Security is handling in our routing file. It looks like this.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_main_controller</span><span class="fu">,</span> <span class="ch">index</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}}]</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span></code></pre></div>
<p>Nova has the possibiltity to have different routes depending on what you want to achieve. So for now we want to add a setting for endpoints that will use a security module.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_main_controller</span><span class="fu">,</span> <span class="ch">index</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}}]</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="fu">{</span><span class="ch">my_first_nova_auth</span><span class="fu">,</span> <span class="ch">auth</span><span class="fu">},</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="st">&quot;/login&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_login_controller</span><span class="fu">,</span> <span class="ch">index</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[</span><span class="ch">post</span><span class="fu">]}}</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">]</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}.</span></span></code></pre></div>
<p>When we add the input form it will submit username and password on the endpoint <code>/login</code>. If it pass our auth module my_first_nova_auth it will show my_first_nova_login.dtl and also my_first_nova_login_controller that will have the logic.</p>
<p>First we change the view for our main page my_first_nova_main.dtl.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;div&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="st">&quot;/login&quot;</span><span class="ot"> method=</span><span class="st">&quot;post&quot;</span><span class="ot"> id=</span><span class="st">&quot;nameform&quot;</span><span class="kw">&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;username&quot;</span><span class="kw">&gt;</span>userame:<span class="kw">&lt;/label&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> id=</span><span class="st">&quot;username&quot;</span><span class="ot"> name=</span><span class="st">&quot;username&quot;</span><span class="kw">&gt;&lt;br&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;password&quot;</span><span class="kw">&gt;</span>Password:<span class="kw">&lt;/label&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;password&quot;</span><span class="ot"> id=</span><span class="st">&quot;password&quot;</span><span class="ot"> name=</span><span class="st">&quot;password&quot;</span><span class="kw">&gt;&lt;br&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value=</span><span class="st">&quot;submit&quot;</span><span class="kw">&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/form&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>We have added an input form now that have username and password. When we click on the submit button it will trigger the auth module.</p>
<p>my_first_nova_auth.erl, we specified in our routing file what the module should be called and the function that will be used.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">my_first_nova_auth</span><span class="fu">).</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">auth</span><span class="op">/</span><span class="dv">1</span><span class="fu">]).</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">auth(</span><span class="va">Req</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">Data</span><span class="fu">,</span> <span class="va">Req1</span><span class="fu">}</span> <span class="op">=</span> <span class="fu">cowboy_req:read_body(</span><span class="va">Req</span><span class="fu">),</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="va">Username</span><span class="fu">,</span> <span class="va">_</span><span class="fu">}</span> <span class="op">=</span> <span class="va">ParsedData</span> <span class="op">=</span> <span class="fu">parse_input(</span><span class="va">Data</span><span class="fu">),</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> <span class="va">ParsedData</span> <span class="kw">of</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span><span class="op">&lt;&lt;</span><span class="st">&quot;daniel&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;test&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">{</span><span class="ch">true</span><span class="fu">,</span> <span class="fu">#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;username&quot;</span><span class="op">&gt;&gt;</span> <span class="op">=&gt;</span> <span class="va">Username</span><span class="fu">,</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                         <span class="op">&lt;&lt;</span><span class="st">&quot;authed&quot;</span><span class="op">&gt;&gt;</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">}};</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>          <span class="va">_</span> <span class="op">-&gt;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">{</span><span class="ch">true</span><span class="fu">,</span> <span class="fu">#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;authed&quot;</span><span class="op">&gt;&gt;</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">}}</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span><span class="fu">.</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_input(</span><span class="va">Data</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">[</span><span class="va">_</span><span class="fu">,</span> <span class="va">Username</span><span class="fu">,</span> <span class="va">_</span><span class="fu">,</span> <span class="va">Password</span><span class="fu">]</span> <span class="op">=</span> <span class="fu">bstring:tokens(</span><span class="va">Data</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;=&amp;&quot;</span><span class="op">&gt;&gt;</span><span class="fu">),</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="va">Username</span><span class="fu">,</span> <span class="va">Password</span><span class="fu">}.</span></span></code></pre></div>
<p>Input will send data as a string so we will need to parse it to get the data. Nova uses cowboy as a web server and it have many functionality how to get headers or body. In this module we use <code>cowboy_req:read_body/1</code>.</p>
<p>Data here will be a binary string <code>&lt;&lt;"username=USERNAME&amp;password=PASSWORD"&gt;&gt;</code>.</p>
<p>bstring is a module that works in the same way as strings in erlang OTP library. Nova have some libraries inbuilt like <a href="https://github.com/JanHenryNystrom/jhn_stdlib">jhn_stdlib</a>.</p>
<p>When we return a tuple with {true, map()}, the map will be passed to the controller as a second argument. If we hada rest api or want to send back a 401 to the one that did the request we return false in our auth module. But in this case we wan’t to redirect back to <code>/</code> if you pass in wrong credentials. If we did enter correct password and username we are going to show <code>Welcome USERNAME!</code>.</p>
<h2 id="we-need-to-create-the-controller-now-and-the-view-for-this-my_first_nova_login_controller.erl-in-srccontrollers.">We need to create the controller now and the view for this, <code>my_first_nova_login_controller.erl</code> in <code>src/controllers/</code>.</h2>
<p><strong><em>Erlang</em></strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">user_management_login_controller</span><span class="fu">).</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">index</span><span class="op">/</span><span class="dv">1</span><span class="fu">]).</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">index(#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;authed&quot;</span><span class="op">&gt;&gt;</span> <span class="fu">:</span><span class="op">=</span> <span class="ch">true</span><span class="fu">,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;&lt;</span><span class="st">&quot;username&quot;</span><span class="op">&gt;&gt;</span> <span class="fu">:</span><span class="op">=</span> <span class="va">Username</span><span class="fu">})</span> <span class="op">-&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="fu">[{</span><span class="ch">message</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;Welcome &quot;</span><span class="fu">,</span> <span class="va">Username</span><span class="op">/</span><span class="ch">binary</span><span class="fu">,</span> <span class="st">&quot;!&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}]};</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">index(</span><span class="va">Req</span><span class="fu">,</span> <span class="fu">#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;authed&quot;</span><span class="op">&gt;&gt;</span> <span class="fu">:</span><span class="op">=</span> <span class="ch">false</span><span class="fu">})</span> <span class="op">-&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">redirect</span><span class="fu">,</span> <span class="st">&quot;/&quot;</span><span class="fu">}.</span></span></code></pre></div>
<hr />
<p><strong><em>LFE</em></strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"></code></pre></div>
<hr />
<p>In the controller we have a index function that take two arguments. First one is a cowboy req the other is nova state.</p>
<p>And then the view <code>my_first_nova_login.dtl</code> should be created in <code>src/views/</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;h1&gt;</span> {{ message }} <span class="kw">&lt;/h1&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>What will happen here is that if we have the correct username and password the auth module will pass on the map we are giving in it. If <code>authed</code>is false it will redirect back to <code>/</code> if it returned true we should print the Username.</p>
<p>In this case we didn’t use any database or so to have users, just to show how things works. If you want to see this with what you enter in the username we can change the auth module to.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">my_first_nova_auth</span><span class="fu">).</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">auth</span><span class="op">/</span><span class="dv">1</span><span class="fu">]).</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">auth(</span><span class="va">Req</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">Data</span><span class="fu">,</span> <span class="va">Req1</span><span class="fu">}</span> <span class="op">=</span> <span class="fu">cowboy_req:read_body(</span><span class="va">Req</span><span class="fu">),</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> <span class="fu">parse_input(</span><span class="va">Data</span><span class="fu">)</span> <span class="kw">of</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="va">Username</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;test&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="ch">true</span><span class="fu">,</span> <span class="fu">#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;username&quot;</span><span class="op">&gt;&gt;</span> <span class="op">=&gt;</span> <span class="va">Username</span><span class="fu">,</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>             <span class="op">&lt;&lt;</span><span class="st">&quot;authed&quot;</span><span class="op">&gt;&gt;</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">}};</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">_</span> <span class="op">-&gt;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="ch">true</span><span class="fu">,</span> <span class="fu">#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;authed&quot;</span><span class="op">&gt;&gt;</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">}}</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span><span class="fu">.</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_input(</span><span class="va">Data</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">[</span><span class="va">_</span><span class="fu">,</span> <span class="va">Username</span><span class="fu">,</span> <span class="va">_</span><span class="fu">,</span> <span class="va">Password</span><span class="fu">]</span> <span class="op">=</span> <span class="fu">bstring:tokens(</span><span class="va">Data</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;=&amp;&quot;</span><span class="op">&gt;&gt;</span><span class="fu">),</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="va">Username</span><span class="fu">,</span> <span class="va">Password</span><span class="fu">}.</span></span></code></pre></div>
<p>In this case Username will be passed on to the controller that will print it on the page.</p>
<hr />
<h2 id="routing">Routing</h2>
<p>Here I will write about routing in Nova and how it works.</p>
<p>When we generate a new nova app we will have a routing file in the directory priv/.</p>
<p>File is named MYAPP.routes.erl in that file we have a erlang map that will specify and configurate what rules is for a endpoint.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_login_controller</span><span class="fu">,</span> <span class="ch">login</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}}]</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span></code></pre></div>
<p>What does this routing configuration say us? Prefix is what we will match against first, in this way you can create different routing configures depending on prefix.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_login_controller</span><span class="fu">,</span> <span class="ch">login</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[</span><span class="ch">post</span><span class="fu">]}}]</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="fu">{</span><span class="ch">my_first_nova_auth</span><span class="fu">,</span> <span class="ch">auth</span><span class="fu">},</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}},</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="st">&quot;/pet&quot;</span><span class="fu">,</span> <span class="fu">{</span><span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user_pet</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}}</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">]</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}.</span></span></code></pre></div>
<p>First map we have a if you go against http://BASEURL:PORT/, we have said we will not have any authentication module on this endpoint. When we reach this endpoint we will call my_first_nova_login_controller:login if method is post.</p>
<p>In the second map we have a prefix that will check that every request with path http://BASEURL:PORT/user/:userid will use this configuration. Here we say that we want to use a auth module, so Nova will use my_first_nova_auth:auth to authenticate the request. If it is ok it will use the module my_first_nova_user_controller:get_user if the request was a get. In this way you can group endpoints also have different auth modules depending on endpoint.</p>
<p>In Nova we can also have explicit routing with that is that an endpoint will go direct to a module and function.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}},</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">update_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[put]}},</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">delete_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[</span><span class="ch">delete</span><span class="fu">]}}]</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span></code></pre></div>
<p>This routing configuration will allow us to decide on method what we want to do at an endpoint. Novas routing is little different from cowboys routing. That is we can have multiple paths that are the same but methods are different.</p>
<p>One of the reasons we choosed to do this way was that we didn’t want to match against methods in our controllers. It would be nice if we knew what we wanted to do in the controller depending on endpoint and method.</p>
<p>The routing file in the end will be a map on what paths goes to what module and functions.</p>
<h3 id="static-content">Static content</h3>
<p>In routing we can also add endpoints for static content.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}},</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">update_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[put]}},</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">delete_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[</span><span class="ch">delete</span><span class="fu">]}}],</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="ch">statics</span> <span class="op">=&gt;</span> <span class="fu">[</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/www/admin&quot;</span><span class="fu">,</span> <span class="st">&quot;assets/admin.html&quot;</span><span class="fu">}</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">]</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span></code></pre></div>
<p>In this routing configuration we have added an endpoint to <code>/www/admin</code> that points to a file called <code>admin.html</code>. When someone goes to <code>/www/admin</code>Nova will serve <code>admin.html</code>.</p>
<p>To serve these files they need to be in priv, but in any directory structure as you want.</p>
<hr />
<h1 id="part-2---api-server">Part 2 - API server</h1>
<h2 id="testing">Testing</h2>
<p>We want to build a pet store that have a api that handles pets in different ways.</p>
<p>Before we start to write Nova api for this it is good to start creating tests so we are sure that things are working when we build the api.</p>
<p>We will use Common test for this and to test with that it is much easier if we use two terminals. One that have the node running and the other that we run our tests in.</p>
<p>In first terminal:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> shell</span></code></pre></div>
<p>This will start Nova and you will see a console when it is done.</p>
<p>In the second terminal we will run common tests with command:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> ct</span></code></pre></div>
<h3 id="test-suite">Test Suite</h3>
<p>First we will create a new directory called <code>test</code> standing in root directory in you app.</p>
<p>In <code>./test</code> you craete a file called <code>pets_SUITE.erl</code> this will be our common test file that will keep our tests. What we want to test is to add a pet, get that pet, change name on pet and then remove the pet. Nova have a http client that can be used in tests (also in the code if want the node to do http requests).</p>
<p>This is a basic common test file:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">pets_SUITE</span><span class="fu">).</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="fu">compile(</span><span class="ch">export_all</span><span class="fu">).</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">%% Includes</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="kw">-include_lib</span><span class="fu">(</span><span class="st">&quot;common_test/include/ct.hrl&quot;</span><span class="fu">).</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">suite()</span> <span class="op">-&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">[{</span><span class="ch">timetrap</span><span class="fu">,{</span><span class="ch">seconds</span><span class="fu">,</span><span class="dv">30</span><span class="fu">}}].</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">init_per_suite(</span><span class="va">Config</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">Config</span><span class="fu">.</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="fu">end_per_suite(</span><span class="va">Config</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="ch">ok</span><span class="fu">.</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">groups()</span> <span class="op">-&gt;</span> <span class="fu">[].</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="fu">all()</span> <span class="op">-&gt;</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">[].</span></span></code></pre></div>
<p>What we will use here is init_per_suite and end_per_suite. Common test have more functionality that you can add, like init_per_group, end_per_group, init_per_testcase and end_per_testcase. All of this will initiate something before running the suite, group or testcase.</p>
<p>In init_per_suite I will have initial thing that will add the pet. The ID we get back I will store in the Config so the testcases that are in the Suite can use it. In end_per_suite I will remove the pet so we clean the data, end_per_suite will also be called if tests fails. This will remove test data that we add.</p>
<p>If we think that our app have a api that will add pets with a name with a post. <code>localhost:8080/pet</code> it will take a json <code>{"name":PETNAME}</code>. In our init_per_suite we will make a http request to our server and see if we get back a json with <code>{"name":PETNAME, "id":ID}</code> and status code 201.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-define</span><span class="fu">(</span><span class="va">OPTS</span><span class="fu">,</span> <span class="fu">#{</span><span class="ch">close</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">,</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                <span class="ch">headers</span> <span class="op">=&gt;</span> <span class="fu">#{</span><span class="ch">&#39;Content-Type&#39;</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;application/json&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}}).</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-define</span><span class="fu">(</span><span class="va">BASE_URL</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;http://localhost:8080/pet&quot;</span><span class="op">&gt;&gt;</span><span class="fu">).</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">init_per_suite(</span><span class="va">Config</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">Json</span> <span class="op">=</span> <span class="fu">json:encode(#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;name&quot;</span><span class="op">&gt;&gt;</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;Hades&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span> <span class="fu">[</span><span class="ch">maps</span><span class="fu">,</span> <span class="ch">binary</span><span class="fu">]),</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> <span class="fu">shttpc:post(?</span><span class="va">BASE_URL</span><span class="fu">,</span> <span class="va">Json</span><span class="fu">,</span> <span class="fu">?</span><span class="va">OPTS</span><span class="fu">)</span> <span class="kw">of</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">#{</span><span class="ch">status</span> <span class="fu">:</span><span class="op">=</span> <span class="fu">{</span><span class="dv">201</span><span class="fu">,</span> <span class="va">_</span><span class="fu">},</span> <span class="ch">body</span> <span class="fu">:</span><span class="op">=</span> <span class="va">Body</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;id&quot;</span><span class="op">&gt;&gt;</span> <span class="fu">:</span><span class="op">=</span> <span class="va">Id</span><span class="fu">}</span> <span class="op">=</span> <span class="fu">json:decode(</span><span class="va">Body</span><span class="fu">,</span> <span class="fu">[</span><span class="ch">maps</span><span class="fu">]),</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">[{</span><span class="ch">id</span><span class="fu">,</span> <span class="va">Id</span><span class="fu">},</span> <span class="fu">{</span><span class="ch">name</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;Hades&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}</span> <span class="fu">|</span> <span class="va">Config</span><span class="fu">]</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span><span class="fu">.</span></span></code></pre></div>
<p>First we declare two macros this is values that will be constant during the tests, like http options and the base_url.</p>
<p>To define a macro you type <code>-define(MACRONAME, MACROVALUE)</code>, when we later want to user a macro we use <code>?MACRONAME</code>.</p>
<p>After we defined the macros we start coding init_per_suite. We encode a Erlang map <code>#{&lt;&lt;"name"&gt;&gt; =&gt; &lt;&lt;"Hades"&gt;&gt;}</code> into a json. After this we will make the post to our server.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">case</span> <span class="fu">shttpc:post(?</span><span class="va">BASE_URL</span><span class="fu">,</span> <span class="va">Json</span><span class="fu">,</span> <span class="fu">?</span><span class="va">OPTS</span><span class="fu">)</span> <span class="kw">of</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">#{</span><span class="ch">status</span> <span class="fu">:</span><span class="op">=</span> <span class="fu">{</span><span class="dv">201</span><span class="fu">,</span> <span class="va">_</span><span class="fu">},</span> <span class="ch">body</span> <span class="fu">:</span><span class="op">=</span> <span class="va">Body</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">#{</span><span class="op">&lt;&lt;</span><span class="st">&quot;id&quot;</span><span class="op">&gt;&gt;</span> <span class="fu">:</span><span class="op">=</span> <span class="va">Id</span><span class="fu">}</span> <span class="op">=</span> <span class="fu">json:decode(</span><span class="va">Body</span><span class="fu">,</span> <span class="fu">[</span><span class="ch">maps</span><span class="fu">]),</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">[{</span><span class="ch">id</span><span class="fu">,</span> <span class="va">Id</span><span class="fu">},</span> <span class="fu">{</span><span class="ch">name</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;Hades&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}</span> <span class="fu">|</span> <span class="va">Config</span><span class="fu">]</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span><span class="fu">.</span></span></code></pre></div>
<p>This code… ## Plugins ##</p>
<p>Plugins in Nova is modules that have a behaviour. These behaviours will be a part of the pipeline flow of a request.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">nova_correlation_plugin</span><span class="fu">).</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="fu">behaviour(</span><span class="ch">nova_plugin</span><span class="fu">).</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">pre_http_request</span><span class="op">/</span><span class="dv">2</span><span class="fu">,</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>         <span class="ch">post_http_request</span><span class="op">/</span><span class="dv">2</span><span class="fu">,</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>         <span class="ch">plugin_info</span><span class="op">/</span><span class="dv">0</span><span class="fu">]).</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">pre_http_request(#{</span><span class="ch">req</span> <span class="fu">:</span><span class="op">=</span> <span class="va">Req</span><span class="fu">}</span> <span class="op">=</span> <span class="va">NovaState</span><span class="fu">,</span> <span class="va">_</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">UUID</span> <span class="op">=</span> <span class="fu">uuid:uuid_to_string(uuid:get_v4()),</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">Req1</span> <span class="op">=</span> <span class="fu">cowboy_req:set_resp_header(</span><span class="op">&lt;&lt;</span><span class="st">&quot;x-correlation-id&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span> <span class="va">UUID</span><span class="fu">,</span> <span class="va">Req</span><span class="fu">),</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">NewState</span> <span class="op">=</span> <span class="fu">maps:put(</span><span class="ch">req</span><span class="fu">,</span> <span class="va">Req1</span><span class="fu">,</span> <span class="va">NovaState</span><span class="fu">),</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">NewState</span><span class="fu">}.</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">post_http_request(</span><span class="va">NovaState</span><span class="fu">,</span> <span class="va">_</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">NovaState</span><span class="fu">}.</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plugin_info()</span> <span class="op">-&gt;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="op">&lt;&lt;</span><span class="st">&quot;nova_cors_plugin&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;0.1.0&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span> <span class="op">&lt;&lt;</span><span class="st">&quot;Add CORS headers to request&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span> <span class="fu">[]}.</span></span></code></pre></div>
<p>This is an example plugin that will add a correlation id to all your request.</p>
<h3 id="pipeline">Pipeline</h3>
<p>We can look at the flow of a request as a pipeline that will go into different plugins before and after it have done controller code.</p>
<p>Plugins can be used on both http and websockets. The example above show two funcitons that the plugin have, pre_http_request (things that is before the controller) and post_http_request (things that is after the controller).</p>
<p>In the routing module we did show that you can use a security module to authenticate endpoints.</p>
<p>In Nova we have a security plugin that will check if security is set or not.</p>
<p><a href="https://github.com/novaframework/nova/blob/master/src/nova_security_plugin.erl">Nova Security Plugin</a></p>
<h3 id="prioritization-configuration">Prioritization &amp; Configuration</h3>
<p>We want to say in what order we want plugins to be run. This we will do in sys.config where we also can add optionsal settings to plugin.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">{</span><span class="ch">nova</span><span class="fu">,</span> <span class="fu">[</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">cowboy_configuration</span><span class="fu">,</span> <span class="fu">#{</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="ch">port</span> <span class="op">=&gt;</span> <span class="dv">8190</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">}},</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">dev_mode</span><span class="fu">,</span> <span class="ch">true</span><span class="fu">},</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">bootstrap_application</span><span class="fu">,</span> <span class="va">MYAPP</span><span class="fu">},</span> <span class="co">%% Bootstraps the application</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>         <span class="co">%% Plugins is written on form {RequestType, Module, Options, Priority}</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>         <span class="co">%% Priority is that the lowest number is executed first</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="ch">plugins</span><span class="fu">,</span> <span class="fu">[</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">{</span><span class="ch">pre_http_request</span><span class="fu">,</span> <span class="ch">nova_security_plugin</span><span class="fu">,</span> <span class="fu">#{},</span> <span class="dv">2</span><span class="fu">},</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">{</span><span class="ch">pre_http_request</span><span class="fu">,</span> <span class="ch">nova_cors_plugin</span><span class="fu">,</span> <span class="fu">#{},</span> <span class="dv">0</span><span class="fu">},</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">{</span><span class="ch">pre_http_request</span><span class="fu">,</span> <span class="ch">nova_request_plugin</span><span class="fu">,</span> <span class="fu">#{</span><span class="ch">decode_json_body</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">,</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>                                                              <span class="ch">parse_bindings</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">,</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>                                                              <span class="ch">parse_qs</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">},</span> <span class="dv">10</span><span class="fu">},</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">{</span><span class="ch">pre_ws_upgrade</span><span class="fu">,</span> <span class="ch">nova_security_plugin</span><span class="fu">,</span> <span class="fu">#{},</span> <span class="dv">20</span><span class="fu">}</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">]}</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">]},</span></span></code></pre></div>
<p>Here we see that we have configured three plugins for http and one for websocket. For http we have the last number in the tuple to say what order to run things. Lowest number runs first.</p>
<p>In this case: nova_cors_plugin with prio at 0 nova_security_plugin with prio at 2 nova_request_plugin with prio at 10</p>
<p>Websocket only have security plugin so it will only run that.</p>
<p>In the nova_request_plugin we have set some values:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="ch">pre_http_request</span><span class="fu">,</span> <span class="ch">nova_request_plugin</span><span class="fu">,</span> <span class="fu">#{</span><span class="ch">decode_json_body</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">,</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                                                              <span class="ch">parse_bindings</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">,</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                                                              <span class="ch">parse_qs</span> <span class="op">=&gt;</span> <span class="ch">true</span><span class="fu">},</span> <span class="dv">10</span><span class="fu">}</span></span></code></pre></div>
<p>What will request plugin do? What it will do is that it will move bindings from cowboy request to nova state. That the state that will be in the function header will look like this:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">req</span> <span class="op">=&gt;</span> <span class="va">CowboyReq</span><span class="fu">,</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">bindings</span> <span class="op">=&gt;</span> <span class="va">Bindings</span><span class="fu">}</span> <span class="fu">(</span><span class="va">Same</span> <span class="ch">as</span> <span class="ch">in</span> <span class="va">CowboyReq</span><span class="fu">,</span> <span class="ch">but</span> <span class="ch">you</span> <span class="ch">don&#39;t need to think of Req)</span></span></code></pre></div>
<p>Then we have decode_json_body this will if we get a body in the request and it it content-type: application/json decode the body and move it to Nova state.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">req</span> <span class="op">=&gt;</span> <span class="va">CowboyReq</span><span class="fu">,</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">bindings</span> <span class="op">=&gt;</span> <span class="va">Bindings</span><span class="fu">,</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">json</span> <span class="op">=&gt;</span> <span class="va">JSONMap</span><span class="fu">}</span> <span class="fu">(</span><span class="va">Keys</span> <span class="ch">in</span> <span class="va">JSONMap</span> <span class="ch">will</span> <span class="ch">be</span> <span class="ch">binary</span><span class="fu">)</span></span></code></pre></div>
<p>The last part of the request plugin will add QS to Nova state if QS is used.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">req</span> <span class="op">=&gt;</span> <span class="va">CowboyReq</span><span class="fu">,</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">bindings</span> <span class="op">=&gt;</span> <span class="va">Bindings</span><span class="fu">,</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">json</span> <span class="op">=&gt;</span> <span class="va">JSONMap</span><span class="fu">,</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="ch">qs</span> <span class="op">=&gt;</span> <span class="va">QS</span><span class="fu">}</span></span></code></pre></div>
<p>Because we have this in a plugin this will happen for all request that is used for this Nova application. So we don’t need to handle json decode for all of our controllers.</p>
<p>Plugins is a way to remove things that you would need to do in all you requests to a place where it is handled by the system for you.</p>
<h3 id="writing-plugins">Writing plugins</h3>
<p>It is possible to write your own plugins. This is a small example of how you can do it. Nova has some templates for this. Getting a plugin templated for you use this command:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> new nova_plugin pluginname</span></code></pre></div>
<p>This will generate a new plugin for you:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">pluginname</span><span class="fu">).</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="fu">behaviour(</span><span class="ch">nova_plugin</span><span class="fu">).</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-include_lib</span><span class="fu">(</span><span class="st">&quot;nova/include/nova.hrl&quot;</span><span class="fu">).</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>         <span class="ch">pre_request</span><span class="op">/</span><span class="dv">2</span><span class="fu">,</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>         <span class="ch">post_request</span><span class="op">/</span><span class="dv">2</span><span class="fu">,</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>         <span class="ch">plugin_info</span><span class="op">/</span><span class="dv">0</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">]).</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">%%--------------------------------------------------------------------</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">%% @doc</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">%% Pre-request callback</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">%% @end</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">%%--------------------------------------------------------------------</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="ch">spec</span> <span class="fu">pre_request(</span><span class="va">State</span> <span class="fu">::</span> <span class="fu">nova_http_handler:nova_http_state(),</span> <span class="va">Options</span> <span class="fu">::</span> <span class="fu">map())</span> <span class="op">-&gt;</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">State0</span> <span class="fu">::</span> <span class="fu">nova_http_handler:nova_http_state()}</span> <span class="fu">|</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">{</span><span class="ch">stop</span><span class="fu">,</span> <span class="va">State0</span> <span class="fu">::</span> <span class="fu">nova_http_handler:nova_http_state()}</span> <span class="fu">|</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">{</span><span class="ch">error</span><span class="fu">,</span> <span class="va">Reason</span> <span class="fu">::</span> <span class="fu">term()}.</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="fu">pre_request(</span><span class="va">State</span><span class="fu">,</span> <span class="va">_Options</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">State</span><span class="fu">}.</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co">%%--------------------------------------------------------------------</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="co">%% @doc</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co">%% Post-request callback</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co">%% @end</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co">%%--------------------------------------------------------------------</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="ch">spec</span> <span class="fu">post_request(</span><span class="va">State</span> <span class="fu">::</span> <span class="fu">nova_http_handler:nova_http_state(),</span> <span class="va">Options</span> <span class="fu">::</span> <span class="fu">map())</span> <span class="op">-&gt;</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">State0</span> <span class="fu">::</span> <span class="fu">nova_http_handler:nova_http_state()}</span> <span class="fu">|</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">{</span><span class="ch">stop</span><span class="fu">,</span> <span class="va">State0</span> <span class="fu">::</span> <span class="fu">nova_http_handler:nova_http_state()}</span> <span class="fu">|</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">{</span><span class="ch">error</span><span class="fu">,</span> <span class="va">Reason</span> <span class="fu">::</span> <span class="fu">term()}.</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="fu">post_request(</span><span class="va">State</span><span class="fu">,</span> <span class="va">_Options</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span> <span class="va">State</span><span class="fu">}.</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="co">%%--------------------------------------------------------------------</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="co">%% @doc</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="co">%% nova_plugin callback. Returns information about the plugin.</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="co">%% @end</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="co">%%--------------------------------------------------------------------</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="ch">spec</span> <span class="fu">plugin_info()</span> <span class="op">-&gt;</span> <span class="fu">{</span><span class="va">Title</span> <span class="fu">::</span> <span class="fu">binary(),</span> <span class="va">Version</span> <span class="fu">::</span> <span class="fu">binary(),</span> <span class="va">Author</span> <span class="fu">::</span> <span class="fu">binary(),</span> <span class="va">Description</span> <span class="fu">::</span> <span class="fu">binary(),</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">[{</span><span class="va">Key</span> <span class="fu">::</span> <span class="fu">atom(),</span> <span class="va">OptionDescription</span> <span class="fu">::</span> <span class="fu">atom()}]}.</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="fu">plugin_info()</span> <span class="op">-&gt;</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="op">&lt;&lt;</span><span class="st">&quot;pluginname plugin&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>     <span class="op">&lt;&lt;</span><span class="st">&quot;0.0.1&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>     <span class="op">&lt;&lt;</span><span class="st">&quot;User &lt;user@email.com&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>     <span class="op">&lt;&lt;</span><span class="st">&quot;Descriptive text&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>     <span class="fu">[]}.</span> <span class="co">%% Options is specified as {Key, Description}</span></span></code></pre></div>
<hr />
<h1 id="part-3---using-js-framework">Part 3 - Using JS framework</h1>
<h2 id="routing-1">Routing</h2>
<p>Here I will write about routing in Nova and how it works.</p>
<p>When we generate a new nova app we will have a routing file in the directory priv/.</p>
<p>File is named MYAPP.routes.erl in that file we have a erlang map that will specify and configurate what rules is for a endpoint.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_login_controller</span><span class="fu">,</span> <span class="ch">login</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}}]</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span></code></pre></div>
<p>What does this routing configuration say us? Prefix is what we will match against first, in this way you can create different routing configures depending on prefix.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_login_controller</span><span class="fu">,</span> <span class="ch">login</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[</span><span class="ch">post</span><span class="fu">]}}]</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="fu">{</span><span class="ch">my_first_nova_auth</span><span class="fu">,</span> <span class="ch">auth</span><span class="fu">},</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="st">&quot;/&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}},</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">{</span><span class="st">&quot;/pet&quot;</span><span class="fu">,</span> <span class="fu">{</span><span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user_pet</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}}</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">]</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}.</span></span></code></pre></div>
<p>First map we have a if you go against http://BASEURL:PORT/, we have said we will not have any authentication module on this endpoint. When we reach this endpoint we will call my_first_nova_login_controller:login if method is post.</p>
<p>In the second map we have a prefix that will check that every request with path http://BASEURL:PORT/user/:userid will use this configuration. Here we say that we want to use a auth module, so Nova will use my_first_nova_auth:auth to authenticate the request. If it is ok it will use the module my_first_nova_user_controller:get_user if the request was a get. In this way you can group endpoints also have different auth modules depending on endpoint.</p>
<p>In Nova we can also have explicit routing with that is that an endpoint will go direct to a module and function.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}},</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">update_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[put]}},</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">delete_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[</span><span class="ch">delete</span><span class="fu">]}}]</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span></code></pre></div>
<p>This routing configuration will allow us to decide on method what we want to do at an endpoint. Novas routing is little different from cowboys routing. That is we can have multiple paths that are the same but methods are different.</p>
<p>One of the reasons we choosed to do this way was that we didn’t want to match against methods in our controllers. It would be nice if we knew what we wanted to do in the controller depending on endpoint and method.</p>
<p>The routing file in the end will be a map on what paths goes to what module and functions.</p>
<h3 id="static-content-1">Static content</h3>
<p>In routing we can also add endpoints for static content.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#{</span><span class="ch">prefix</span> <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="ch">security</span> <span class="op">=&gt;</span> <span class="ch">false</span><span class="fu">,</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="ch">routes</span> <span class="op">=&gt;</span> <span class="fu">[{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">get_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[get]}},</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">update_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[put]}},</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/user/:userid&quot;</span><span class="fu">,</span> <span class="fu">{</span> <span class="ch">my_first_nova_user_controller</span><span class="fu">,</span> <span class="ch">delete_user</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">methods</span> <span class="op">=&gt;</span> <span class="fu">[</span><span class="ch">delete</span><span class="fu">]}}],</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="ch">statics</span> <span class="op">=&gt;</span> <span class="fu">[</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">{</span><span class="st">&quot;/www/admin&quot;</span><span class="fu">,</span> <span class="st">&quot;assets/admin.html&quot;</span><span class="fu">}</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">]</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">}.</span></span></code></pre></div>
<p>In this routing configuration we have added an endpoint to <code>/www/admin</code> that points to a file called <code>admin.html</code>. When someone goes to <code>/www/admin</code>Nova will serve <code>admin.html</code>.</p>
<p>To serve these files they need to be in priv, but in any directory structure as you want.</p>
<hr />
<h1 id="erlang">Erlang</h1>
<h2 id="erlang-books">Erlang books</h2>
<p><a href="https://learnyousomeerlang.com">Learn you some erlang</a></p>
<p><a href="https://adoptingerlang.org">Adopting Erlang</a></p>
<p><a href="https://www.erlang-in-anger.com">Erlang in anger</a></p>
<hr />
<h2 id="recursive-functions">Recursive functions</h2>
<p>This is me trying to describe recursive functions in Erlang. How you can write them and how it works.</p>
<p>Erlang uses recursive functions often because in other languages you have for, while and other loops. In Erlang we do it with recursive functions.</p>
<p>Example:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">recursive</span><span class="fu">).</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">sum</span><span class="op">/</span><span class="dv">1</span><span class="fu">]).</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([])</span> <span class="op">-&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span><span class="fu">;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="va">Head</span> <span class="fu">|</span> <span class="va">Tail</span><span class="fu">])</span> <span class="op">-&gt;</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>   <span class="va">Head</span> <span class="op">+</span> <span class="fu">sum(</span><span class="va">Tail</span><span class="fu">).</span></span></code></pre></div>
<p>Here we do a sum function that will take a list of integers and summarize them.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="op">&gt;</span> recursive:sum<span class="kw">(</span><span class="ex">[1,2,3]</span><span class="kw">)</span><span class="bu">.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span></span></code></pre></div>
<p>What happen when we call our function?</p>
<p>Thing in Erlang works that we go from the top to the bottom of our code.</p>
<p>recursive:sum([1,2,3]). When we call this function with argument [1,2,3] this will happen.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([])</span> <span class="op">-&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span><span class="fu">;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="dv">1</span> <span class="fu">|</span> <span class="fu">[</span><span class="dv">2</span><span class="fu">,</span><span class="dv">3</span><span class="fu">]])</span> <span class="op">-&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1</span> <span class="op">+</span> <span class="fu">sum([</span><span class="dv">2</span><span class="fu">,</span><span class="dv">3</span><span class="fu">]).</span></span></code></pre></div>
<p>First we will hit the first function clause and because our list contain three elements it will go on to the next function clause. Here the head of the list will be 1 and the tail will be list with two elements [2,3].</p>
<p>The recursive call that we call our function sum again but now with the tail will give us.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([])</span> <span class="op">-&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span><span class="fu">;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="dv">2</span> <span class="fu">|</span> <span class="fu">[</span><span class="dv">3</span><span class="fu">]])</span> <span class="op">-&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span> <span class="op">+</span> <span class="fu">sum([</span><span class="dv">3</span><span class="fu">]).</span></span></code></pre></div>
<p>We also do that with the last element in the list.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([])</span> <span class="op">-&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span><span class="fu">;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="dv">3</span> <span class="fu">|</span> <span class="fu">[]])</span> <span class="op">-&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span> <span class="op">+</span> <span class="fu">sum([]).</span></span></code></pre></div>
<p>Last call here will hit the base case and return a 0.</p>
<p>This will calculate 3 + 2 + 1 + 0 (base case) = 6.</p>
<p>You can also do this with tail recursive so you pass the result of the recursive to the next.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([],</span> <span class="va">Sum</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">Sum</span><span class="fu">;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="va">Head</span> <span class="fu">|</span> <span class="va">Tail</span><span class="fu">],</span> <span class="va">Sum</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum(</span><span class="va">Tail</span><span class="fu">,</span> <span class="va">Sum</span> <span class="op">+</span> <span class="va">Head</span><span class="fu">).</span></span></code></pre></div>
<p>This is our function with tail recursive. What will happen here is very similar to what we did above. Different now is that we to the addition in the recursive step and send the result to the next recursive. When we hit base case we will return the result.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="op">&gt;</span> <span class="fu">c(</span><span class="ch">recursive</span><span class="fu">).</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="ch">ok</span><span class="fu">,</span><span class="ch">recursive</span><span class="fu">}</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="op">&gt;</span> <span class="fu">recursive:sum([</span><span class="dv">1</span><span class="fu">,</span><span class="dv">2</span><span class="fu">,</span><span class="dv">3</span><span class="fu">],</span> <span class="dv">0</span><span class="fu">).</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span></span></code></pre></div>
<p>We have now created a function called sum that now have aritry 2. It will take the list with integers and the start value.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([],</span> <span class="va">Sum</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">Sum</span><span class="fu">;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="dv">1</span> <span class="fu">|</span> <span class="fu">[</span><span class="dv">2</span><span class="fu">,</span><span class="dv">3</span><span class="fu">]],</span> <span class="dv">0</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum([</span><span class="dv">2</span><span class="fu">,</span><span class="dv">3</span><span class="fu">],</span> <span class="dv">0</span> <span class="op">+</span> <span class="dv">1</span><span class="fu">).</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([],</span> <span class="va">Sum</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">Sum</span><span class="fu">;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="dv">2</span> <span class="fu">|</span> <span class="fu">[</span><span class="dv">3</span><span class="fu">]],</span> <span class="dv">1</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum([</span><span class="dv">3</span><span class="fu">],</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span><span class="fu">).</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([],</span> <span class="va">Sum</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">Sum</span><span class="fu">;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="dv">3</span> <span class="fu">|</span> <span class="fu">[]],</span> <span class="dv">3</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum([],</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span><span class="fu">).</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([],</span> <span class="dv">6</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>   <span class="dv">6</span><span class="fu">;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum([</span><span class="va">Head</span> <span class="fu">|</span> <span class="va">Tail</span><span class="fu">],</span> <span class="va">Sum</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum(</span><span class="va">Tail</span><span class="fu">,</span> <span class="va">Sum</span> <span class="op">+</span> <span class="va">Head</span><span class="fu">).</span></span></code></pre></div>
<p>When we hit the base case and the list is empty we will return the variable Sum that is in this case 6.</p>
<hr />
<h2 id="pattern-matching">Pattern matching</h2>
<p>In last section we did some recursive functions. Now we will try to do some pattern matching and later combine it with recursive functions.</p>
<p>When it comes to Erlang we execute from right to left that makes it easier to understand the error message.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">&gt;</span> <span class="va">Variable</span> <span class="op">=</span> <span class="dv">1</span><span class="fu">.</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="op">&gt;</span> <span class="va">Variable</span> <span class="op">=</span> <span class="dv">1</span><span class="fu">.</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="op">&gt;</span> <span class="dv">1</span> <span class="op">=</span> <span class="va">Variable</span><span class="fu">.</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="op">&gt;</span> <span class="ch">a</span> <span class="op">=</span> <span class="va">Variable</span><span class="fu">.</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="op">**</span> <span class="ch">exception</span> <span class="ch">error</span><span class="fu">:</span> <span class="ch">no</span> <span class="ch">match</span> <span class="kw">of</span> <span class="ch">right</span> <span class="ch">hand</span> <span class="ch">side</span> <span class="ch">value</span> <span class="dv">1</span></span></code></pre></div>
<p>This is a Erlang shell that we bind Variable to 1 and then pattern match.</p>
<p>At 3&gt;, we try to pattern match 1 to Variable, if Variable haven’t been set before it will be 1. But now it is set at 2&gt;. At 4&gt;, we try to match Variable to 1, and if it is ok the value is returned. At 5&gt; we have a mismatch, this is where we match things from right to left. So on the right hand side we try to match 1 to a. That fails because of a no match.</p>
<p>One other example we can do is fibonacci. Fibonacci works that it do addition on the last number and the number before. 1, 1, 2, 3, 5, 8, 13.</p>
<p>We implement this in Erlang using recursion and pattern matching.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">fibonacci</span><span class="fu">).</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">fib</span><span class="op">/</span><span class="dv">1</span><span class="fu">]).</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fib(</span><span class="dv">0</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span><span class="fu">;</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fib(</span><span class="dv">1</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="fu">;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fib(</span><span class="va">N</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fib(</span><span class="va">N</span><span class="op">-</span><span class="dv">1</span><span class="fu">)</span> <span class="op">+</span> <span class="fu">fib(</span><span class="va">N</span><span class="op">-</span><span class="dv">2</span><span class="fu">).</span></span></code></pre></div>
<p>What does our code do?</p>
<p>We have two base case here, if N is 0 and if N is 1. In the last function clause we call fib function with N-1 and N-2.</p>
<h3 id="maps-records-tuples">maps, records, tuples</h3>
<p>Say that we want to do different things depending on a value in a map.</p>
<p>We get a list with maps that looks something like:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">[#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span> <span class="fu">#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;email&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}]</span></span></code></pre></div>
<p>We want to sum the amount of each type in our list.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-module</span><span class="fu">(</span><span class="ch">pattern</span><span class="fu">).</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-export</span><span class="fu">([</span><span class="ch">sum_by_type</span><span class="op">/</span><span class="dv">1</span><span class="fu">,</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>         <span class="ch">generate_list</span><span class="op">/</span><span class="dv">0</span><span class="fu">]).</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_by_type(</span><span class="va">List</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum_by_type_aux(</span><span class="va">List</span><span class="fu">,</span> <span class="fu">[]).</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_by_type_aux([],</span> <span class="va">Acc</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">Acc</span><span class="fu">;</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_by_type_aux([#{</span><span class="ch">type</span> <span class="fu">:</span><span class="op">=</span> <span class="va">Type</span><span class="fu">}</span> <span class="fu">|</span> <span class="va">Tail</span><span class="fu">],</span> <span class="va">Acc</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> <span class="fu">get_value(</span><span class="va">Acc</span><span class="fu">,</span> <span class="va">Type</span><span class="fu">)</span> <span class="kw">of</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        <span class="ch">undefined</span> <span class="op">-&gt;</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum_by_type_aux(</span><span class="va">Tail</span><span class="fu">,</span> <span class="fu">[{</span><span class="va">Type</span><span class="fu">,</span> <span class="dv">1</span><span class="fu">}</span> <span class="fu">|</span> <span class="va">Acc</span><span class="fu">]);</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">Value</span> <span class="op">-&gt;</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">NewAcc</span> <span class="op">=</span> <span class="fu">remove_value(</span><span class="va">Acc</span><span class="fu">,</span> <span class="va">Type</span><span class="fu">),</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum_by_type_aux(</span><span class="va">Tail</span><span class="fu">,</span> <span class="fu">[{</span><span class="va">Type</span><span class="fu">,</span> <span class="va">Value</span> <span class="op">+</span> <span class="dv">1</span><span class="fu">}</span> <span class="fu">|</span> <span class="va">NewAcc</span><span class="fu">])</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span><span class="fu">.</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a><span class="fu">get_value([],</span> <span class="va">_</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="ch">undefined</span><span class="fu">;</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="fu">get_value([{</span><span class="va">Type</span><span class="fu">,</span> <span class="va">Value</span><span class="fu">}|</span><span class="va">_</span><span class="fu">],</span> <span class="va">Type</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    <span class="va">Value</span><span class="fu">;</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="fu">get_value([</span><span class="va">_</span> <span class="fu">|</span> <span class="va">Tail</span><span class="fu">],</span> <span class="va">Type</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_value(</span><span class="va">Tail</span><span class="fu">,</span> <span class="va">Type</span><span class="fu">).</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="fu">remove_value(</span><span class="va">List</span><span class="fu">,</span> <span class="va">Type</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_value_aux(</span><span class="va">List</span><span class="fu">,</span> <span class="va">Type</span><span class="fu">,</span> <span class="fu">[]).</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="fu">remove_value_aux([],</span> <span class="va">_</span><span class="fu">,</span> <span class="va">Acc</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>    <span class="va">Acc</span><span class="fu">;</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="fu">remove_value_aux([{</span><span class="va">Type</span><span class="fu">,</span> <span class="va">_</span><span class="fu">}</span> <span class="fu">|</span> <span class="va">Tail</span><span class="fu">],</span> <span class="va">Type</span><span class="fu">,</span> <span class="va">Acc</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_value_aux(</span><span class="va">Tail</span><span class="fu">,</span> <span class="va">Type</span><span class="fu">,</span> <span class="va">Acc</span><span class="fu">);</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="fu">remove_value_aux([</span><span class="va">Head</span> <span class="fu">|</span> <span class="va">Tail</span><span class="fu">],</span> <span class="va">Type</span><span class="fu">,</span> <span class="va">Acc</span><span class="fu">)</span> <span class="op">-&gt;</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_value_aux(</span><span class="va">Tail</span><span class="fu">,</span> <span class="va">Type</span><span class="fu">,</span> <span class="fu">[</span><span class="va">Head</span> <span class="fu">|</span> <span class="va">Acc</span><span class="fu">]).</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_list()</span> <span class="op">-&gt;</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">[#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>     <span class="fu">#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">email</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>     <span class="fu">#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>     <span class="fu">#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">email</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>     <span class="fu">#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">},</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>     <span class="fu">#{</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">,</span> <span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">}].</span></span></code></pre></div>
<p>Here is the code that will handle the sum and sort things. We create one function that will be the exported and that function will call a helper function with two arguments. First is the input we get, the other argument is the accumulator that we will return.</p>
<p>Helper function will match first element in the list and then check if we have already summed it. I have created my own functions now to get values and remove values to more show how pattern matching and recursion works. OTP library have proplists module or other modules to do this.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode erlang"><code class="sourceCode erlang"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="op">&gt;</span> <span class="va">List</span> <span class="op">=</span> <span class="fu">pattern:generate_list().</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">[#{</span><span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">},</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">#{</span><span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">email</span><span class="fu">},</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">#{</span><span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">},</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">#{</span><span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">email</span><span class="fu">},</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">#{</span><span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">},</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">#{</span><span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">},</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">#{</span><span class="ch">text</span> <span class="op">=&gt;</span> <span class="op">&lt;&lt;</span><span class="st">&quot;hi&quot;</span><span class="op">&gt;&gt;</span><span class="fu">,</span><span class="ch">type</span> <span class="op">=&gt;</span> <span class="ch">sms</span><span class="fu">}]</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="op">&gt;</span> <span class="fu">pattern:sum_by_type(</span><span class="va">List</span><span class="fu">).</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">[{</span><span class="ch">sms</span><span class="fu">,</span><span class="dv">5</span><span class="fu">},{</span><span class="ch">email</span><span class="fu">,</span><span class="dv">2</span><span class="fu">}]</span></span></code></pre></div>
<p>Small examples on how to use lists, tuples and maps.</p>
<hr />
<h2 id="releases">Releases</h2>
<h2 id="supervisors">Supervisors</h2>
<h1 id="beam-languages">Beam languages</h1>
<h2 id="lfe">LFE</h2>
<p>It is possible to start an LFE web application with Nova.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rebar3</span> new nova_lfe mylfeapp</span></code></pre></div>
<p>This will follow much of the getting started pages in Nova section.</p>
</body>
</html>
